{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://wszdb-shareurl/webpack/bootstrap","webpack://wszdb-shareurl/webpack/runtime/compat get default export","webpack://wszdb-shareurl/webpack/runtime/define property getters","webpack://wszdb-shareurl/webpack/runtime/hasOwnProperty shorthand","webpack://wszdb-shareurl/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://wszdb-shareurl/external root \"flarum.core.compat['common/extend']\"","webpack://wszdb-shareurl/external root \"flarum.core.compat['forum/app']\"","webpack://wszdb-shareurl/external root \"flarum.core.compat['common/components/Button']\"","webpack://wszdb-shareurl/external root \"flarum.core.compat['common/components/Modal']\"","webpack://wszdb-shareurl/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://wszdb-shareurl/./js/src/forum/index.js","webpack://wszdb-shareurl/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","import { extend } from 'flarum/common/extend';\r\nimport app from 'flarum/forum/app';\r\nimport Button from 'flarum/common/components/Button';\r\nimport Modal from 'flarum/common/components/Modal';\r\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\r\n\r\n// 外链警告模态框组件\r\nclass LinkWarningModal extends Modal {\r\n    oninit(vnode) {\r\n        super.oninit(vnode);\r\n        this.linkUrl = this.attrs.linkUrl;\r\n        this.warningText = this.attrs.warningText;\r\n    }\r\n\r\n    title() {\r\n        return app.translator.trans('wszdb-shareurl.forum.link_warning_title');\r\n    }\r\n\r\n    className() {\r\n        return 'LinkWarningModal';\r\n    }\r\n\r\n    content() {\r\n        return (\r\n            <div className=\"Modal-body\">\r\n                <p>{this.warningText}</p>\r\n                <div className=\"Modal-footer\" style={{ justifyContent: 'flex-start', marginTop: '20px' }}>\r\n                    <Button className=\"Button Button--primary\" onclick={() => this.hide()}>\r\n                        {app.translator.trans('wszdb-shareurl.forum.cancel_button')}\r\n                    </Button>\r\n                    <span style={{ margin: '0 20px' }}>&nbsp;</span>\r\n                    <Button \r\n                        className=\"Button Button--primary\" \r\n                        onclick={() => {\r\n                            window.open(this.linkUrl, '_blank');\r\n                            this.hide();\r\n                        }}\r\n                    >\r\n                        {app.translator.trans('wszdb-shareurl.forum.confirm_button')}\r\n                    </Button>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\napp.initializers.add('wszdb-shareurl', () => {\r\n    // 添加外链警告功能，修复跳转问题\r\n    extend(app, 'mount', () => {\r\n        const handleLinkClick = (e) => {\r\n            const target = e.target.closest('a');\r\n            if (target && target.href) {\r\n                const currentHost = window.location.hostname;\r\n                const linkHost = new URL(target.href).hostname;\r\n                \r\n                // 检查是否为外链\r\n                if (linkHost !== currentHost) {\r\n                    const whitelist = app.forum.attribute('wszdb.shareurl.whitelist') || [];\r\n                    const isWhitelisted = whitelist.some(keyword => \r\n                        target.href.includes(keyword.trim())\r\n                    );\r\n                    \r\n                    if (!isWhitelisted) {\r\n                        e.preventDefault();\r\n                        e.stopPropagation();\r\n                        \r\n                        const warningText = app.forum.attribute('wszdb.shareurl.warningText') || \r\n                            app.translator.trans('wszdb-shareurl.forum.warning_message');\r\n                        \r\n                        // 显示Flarum风格的模态框\r\n                        setTimeout(() => {\r\n                            app.modal.show(LinkWarningModal, {\r\n                                linkUrl: target.href,\r\n                                warningText: warningText\r\n                            });\r\n                        }, 0);\r\n                        \r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        \r\n        // 使用passive事件监听器提高性能\r\n        document.body.addEventListener('click', handleLinkClick, { passive: false });\r\n    });\r\n    \r\n    // 添加复制链接按钮到讨论页面，完全参考书签插件的方式\r\n    extend(DiscussionPage.prototype, 'sidebarItems', function (items) {\r\n        // 检查是否启用复制链接功能\r\n        const enableCopyLink = app.forum.attribute('wszdb.shareurl.enableCopyLink');\r\n        if (!enableCopyLink) return;\r\n        \r\n        // 参考书签插件的按钮实现方式，添加链接图标，使用次要按钮样式\r\n        items.add('copyLink', Button.component({\r\n            className: 'Button Button--secondary',\r\n            icon: 'fas fa-link',\r\n            onclick: () => copyDiscussionLink(this.discussion)\r\n        }, app.translator.trans('wszdb-shareurl.forum.copy_link_button')), 10);\r\n    });\r\n});\r\n\r\n// 复制讨论链接函数\r\nfunction copyDiscussionLink(discussion) {\r\n    const title = discussion.title();\r\n    const url = window.location.href;\r\n    const text = `${title}\\n${url}`;\r\n    \r\n    if (navigator.clipboard) {\r\n        navigator.clipboard.writeText(text).then(() => {\r\n            // 使用简单的DOM操作显示提示，避免alert系统错误\r\n            showCopySuccessMessage();\r\n        }).catch(() => {\r\n            fallbackCopyTextToClipboard(text);\r\n        });\r\n    } else {\r\n        fallbackCopyTextToClipboard(text);\r\n    }\r\n}\r\n\r\n// 显示复制成功消息，位置改为左下角\r\nfunction showCopySuccessMessage() {\r\n    const message = app.translator.trans('wszdb-shareurl.forum.copy_success');\r\n    const alertDiv = document.createElement('div');\r\n    alertDiv.className = 'Alert Alert--success';\r\n    alertDiv.style.position = 'fixed';\r\n    alertDiv.style.bottom = '20px';\r\n    alertDiv.style.left = '20px';\r\n    alertDiv.style.zIndex = '9999';\r\n    \r\n    // 添加链接图标，使用Unicode字符避免图标加载问题\r\n    const icon = document.createElement('span');\r\n    icon.innerHTML = '🔗 ';\r\n    icon.style.marginRight = '8px';\r\n    \r\n    alertDiv.appendChild(icon);\r\n    alertDiv.appendChild(document.createTextNode(message));\r\n    \r\n    document.body.appendChild(alertDiv);\r\n    \r\n    // 2秒后自动消失\r\n    setTimeout(() => {\r\n        if (alertDiv.parentNode) {\r\n            alertDiv.parentNode.removeChild(alertDiv);\r\n        }\r\n    }, 2000);\r\n}\r\n\r\n// 备用复制方法\r\nfunction fallbackCopyTextToClipboard(text) {\r\n    const textArea = document.createElement(\"textarea\");\r\n    textArea.value = text;\r\n    textArea.style.top = \"0\";\r\n    textArea.style.left = \"0\";\r\n    textArea.style.position = \"fixed\";\r\n    document.body.appendChild(textArea);\r\n    textArea.focus();\r\n    textArea.select();\r\n    \r\n    try {\r\n        document.execCommand('copy');\r\n        showCopySuccessMessage();\r\n    } catch (err) {\r\n        const errorMessage = app.translator.trans('wszdb-shareurl.forum.copy_failed');\r\n        const alertDiv = document.createElement('div');\r\n        alertDiv.className = 'Alert Alert--error';\r\n        alertDiv.style.position = 'fixed';\r\n        alertDiv.style.bottom = '20px';\r\n        alertDiv.style.left = '20px';\r\n        alertDiv.style.zIndex = '9999';\r\n        alertDiv.textContent = errorMessage;\r\n        \r\n        document.body.appendChild(alertDiv);\r\n        \r\n        setTimeout(() => {\r\n            if (alertDiv.parentNode) {\r\n                alertDiv.parentNode.removeChild(alertDiv);\r\n            }\r\n        }, 2000);\r\n    }\r\n    \r\n    document.body.removeChild(textArea);\r\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","flarum","core","compat","LinkWarningModal","_Modal","apply","arguments","create","constructor","_proto","oninit","vnode","this","linkUrl","attrs","warningText","title","app","trans","className","content","_this","m","style","justifyContent","marginTop","Button","onclick","hide","margin","window","open","Modal","showCopySuccessMessage","message","alertDiv","document","createElement","position","bottom","left","zIndex","icon","innerHTML","marginRight","appendChild","createTextNode","body","setTimeout","parentNode","removeChild","fallbackCopyTextToClipboard","text","textArea","value","top","focus","select","execCommand","err","errorMessage","textContent","add","extend","addEventListener","target","closest","href","currentHost","location","hostname","URL","attribute","some","keyword","includes","trim","preventDefault","stopPropagation","show","passive","DiscussionPage","items","_this2","discussion","url","navigator","clipboard","writeText","then"],"sourceRoot":""}